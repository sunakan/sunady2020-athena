<source>
  @type  forward
  @label @raw
  port "#{ENV['FLUENTD_PORT'] || 24224}"
</source>

# timeというkeyに時間を突っ込む
# fluentdのtimeいはunix_timeを利用
# コンテナのTZをAsia/Tokyoにして、なんとか日本時間にしている
# （<format> timezone +09:00では上手くいかなかったため）
<label @raw>
  <filter **>
    @type record_transformer
    enable_ruby
    <record>
      time ${Time.at(record["unix_time"]).utc.getlocal('+09:00')}
    </record>
    renew_time_key unix_time
  </filter>
  <match **>
    @type copy
    #<store>
    #  @type relabel
    #  @label @main
    #</store>
    <store>
      @type relabel
      @label @debug
    </store>
  </match>
</label>

<label @debug>
  <match **>
    @type stdout
  </match>
</label>
